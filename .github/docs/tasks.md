# 計画 (Excel グラフ自動化ツール)

## 目的
- 新卒エンジニア向けポートフォリオとして、研究用途でも使える Excel グラフ自動化ツールを Python で作成する。

## 関連ドキュメント / 既存ファイル
- .github/docs/reports/2025-12-16.md
- .github/copilot-instructions.md
- README.md

## 前提・環境
- OS: Windows
- 言語/ランタイム: Python (バージョン未定、3.10 以上を想定)
- 主要ライブラリ候補: pandas、openpyxl、matplotlib または plotly

## スコープ (初期バージョン)
- 入力: xlsx ファイルと設定 (CLI 引数または設定ファイル)。
- 処理: シート/セル範囲指定からデータ取得、グラフ生成 (散布図を基本。折れ線/棒は拡張)、軸ラベル・凡例・タイトルの自動付与。
- 出力: Excel 内に指定フォーマットのグラフを自動生成・更新する (画像保存は将来的なオプションとする)。

## 機能要件 (最小)
- CLI インターフェースで入力ファイル/シート/範囲/グラフ種別/出力先を指定できる。
- データの欠損/非数値行のスキップや警告を行う。
- 複数グラフのバッチ生成をサポート (複数設定の一括指定)。
- 生成結果のログ出力 (成功/失敗、保存先)。
- グラフスタイルのプリセット選択 (デフォルトは提供イメージに近い散布図/線グラフスタイル) を行える。
- 複数系列の散布図に対応し、系列名を凡例に自動反映する。
- 軸範囲・目盛刻みをデータ範囲から自動算出しつつ、設定で固定値も指定できる。
- Excel ワークブック内にグラフオブジェクトを挿入/更新する (埋め込み位置はシート上の指定セル/座標を設定で指定)。

## 非機能・品質
- セットアップ手順を README に記載 (依存ライブラリ、実行例)。
- サンプルデータとサンプル設定を提供し、再現可能な動作確認ができること。
- CLI 実行時間は小中規模データで実用的 (数秒〜十数秒) であること。
- スタイルプリセットを固定化し、バージョン差分による描画揺らぎを避ける。
- Excel 内描画での再現性を重視し、フォント/サイズ (Arial 32pt) を明示設定する。

## スタイル要件 (複数系列散布図例)
- グラフ種別: 2D 散布図 (マーカーなしの折れ線的描画) を基本。複数系列対応。
- 配色: 背景は白、枠は黒系。系列色は下記パレットから先頭 4 色をデフォルト使用。
- カラーパレット (10 色案; 学術用途で視認性重視)
  - 1: #1f77b4 (ブルー)
  - 2: #d62728 (レッド)
  - 3: #2ca02c (グリーン)
  - 4: #ff7f0e (オレンジ)
  - 5: #9467bd (パープル)
  - 6: #8c564b (ブラウン)
  - 7: #17becf (シアン)
  - 8: #e377c2 (マゼンタ)
  - 9: #bcbd22 (オリーブ)
  - 10: #7f7f7f (グレー)
- 線スタイル: 太めの線幅 (デフォルト 3pt、必要に応じて設定で変更可) でスムーズに描画。
- 軸/ラベル: Arial 32pt 太字、軸ラベル例 `Displacement [mm]` (x) と `Load [kN]` (y) など。目盛ラベルも同フォント系で統一。
- 目盛: x=0.0〜10.0 を 0.5〜1.0 刻み、y=0.0〜16.0 を 1.0 刻み程度を想定 (自動算出が基本で固定指定も可)。
- 原点: 可能な範囲で (0,0) を含めるよう軸範囲を自動調整 (設定で固定も可)。
- 凡例: 上部中央に配置する例をデフォルトとし、系列名を列ヘッダーから取得。
- レイアウト: 画像保存はデフォルトOFF (必要なら設定でON)。Excel 埋め込み時の図のサイズや位置は設定で指定可能にする。

## スタイル要件 (単系列サンプル: Strain-Stress)
- グラフ種別: 2D 折れ線 (単系列) を基本。
- 配色: 太めのグリーン系ライン (例: #3d9b2c 付近)、背景は白、枠は黒系。
- 線スタイル: 線幅を太めに設定し、エッジをスムーズに描画。
- 軸: 太字かつ大きめのフォント。軸ラベル例 `Strain [-]` (x) と `Stress [MPa]` (y)。
- 目盛: x=0.0〜1.0 を 0.1 刻み程度、y=0.0〜6.0 を 1.0 刻み程度で表示する例。
- 余白・レイアウト: 画像サイズは横長 (例: 1280x720 付近) を想定。凡例なしを基本とし、必要に応じて追加可能とする。

## サンプルデータ仕様の暫定イメージ
- シート名: `Data` を想定 (確認要)。
- 列構成例: A 列=X 軸 (例: Displacement)、B 列=Type A、C 列=Type B といった複数系列。ヘッダー行あり。
- 欠損: NaN や空欄はスキップし、警告ログに記録する。
- 系列マッピング: ヘッダー名を凡例に使用し、任意の列数に対応できるよう設定でマッピング可能とする。

## 配置方針 (Excel 埋め込み)
- デフォルト: 専用シート (例: Charts) の既定セル起点 (例: B2) にグラフを配置。サイズ・アンカーは設定値で制御し、ブック構造変化時は設定のみ変更で対応。
- オプション: 配置指定を省略した場合はデータシート右側に自動配置する簡易モードを用意し、手戻りを減らす。
- グラフ更新: 同じグラフ名/ID が存在すれば上書き更新し、重複生成を防ぐ。

## 実装上の想定ライブラリ
- Excel 読み書き: openpyxl を第一候補 (Excel へのグラフ挿入/更新を行うため)。必要に応じて xlsxwriter も検討。
- データ処理: pandas を使用。

## 将来拡張 (案)
- 外部 API 連携でデータの特徴から適したグラフ種別をレコメンドし、設定不要でグラフを自動生成するモードを追加。
- 無料で制限なく使える推論エンジンやルールベース判定を優先検討し、コスト・制限を避ける方針とする。

## タスク案
1. 要件具体化: サンプル Excel と望むグラフ例を確認。不明点を確定。
2. 設計: 入力パラメータ仕様 (CLI/設定ファイル) と内部フロー (読み込み→整形→描画→出力) を記述。
3. 環境整備: Python バージョン決定、依存ライブラリ選定、requirements/pyproject 準備。
4. データ入出力実装: xlsx 読み込み・範囲抽出・型変換・バリデーション。
5. グラフ生成実装: グラフ種別ごとの描画関数、スタイル初期値、画像保存。
6. CLI 実装: コマンド構造、引数パース、バッチ処理、ログ出力。
7. テスト/デモ: サンプルデータ・設定で動作確認、README に使用方法・例を追加。

## 不明点 (要確認)
- 入力 Excel の最終確定 (シート名、列名、複数系列の有無、欠損の扱い)。
- 線幅とデフォルトの軸範囲/目盛刻みを固定するか、自動をデフォルトにするか。
- Excel 埋め込み時の配置詳細 (シート名とセル起点)、簡易自動配置モードの要否。
- 画像保存オプションを完全に不要とするか、将来用にオフデフォルトで残すか。
- 研究特有の統計処理の要否 (平均・分散・エラーバー・移動平均など)。

## 次ステップ (合意後)
- 不明点をヒアリングして要件を確定。
- Python バージョンと主要ライブラリを固定し、セットアップ手順を用意。
- 設計ドキュメント (CLI 仕様・処理フロー) を作成し、実装フェーズに進む。
